source('~/covid/publica/fasecero.github.io/scripts/grafico10.r')
source('~/covid/prediccion.r')
graficoProyeccion
source('~/covid/publica/fasecero.github.io/scripts/grafico10.r')
d1 <- datoscovidok[datoscovidok$subContinente == 'America Latina y Caribe' & datoscovidok$popData2018 > 10000000 & datoscovidok$deathsAcum > 50 & datoscovidok$countriesAndTerritories != 'Dominican_Republic' & datoscovidok$countriesAndTerritories != 'Cuba',];
muertesAL <- ggplot(
data = d1,
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes acumuladas', caption = caption) +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(max(datoscovidok$realDate)))) +
scale_color_brewer(palette="Set1");
muertesALCada100 <- ggplot(
data = d1,
mapping = aes(
x = realDate,
y = deathsAcum / popData2018 * 100000,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes acumuladas cada 100.000 habitantes', caption = caption) +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(max(datoscovidok$realDate)))) +
scale_color_brewer(palette="Set1");
muertesAL + muertesALCada100
datosargentina <- datoscovidok[datoscovidok$countriesAndTerritories == 'Argentina',];
datosargentina <- datosargentina[rev(order(datosargentina$realDate)), ];
ultimosDatos <- head(datosargentina, n= 15);
ultimoDato <- head(ultimosDatos, n= 1);
primerDato <- tail(ultimosDatos, n= 1);
model <- lm(diasDuplicar ~ realDate, data = ultimosDatos);
nuevosDias <- NULL;
nuevosDias$realDate <- seq(max(ultimosDatos$realDate)+1,by = 'day', length.out = 30);
nuevosDias$diasDuplicar <- predict(model, newdata = nuevosDias);
df <- data.frame(realDate = nuevosDias$realDate, diasDuplicar = nuevosDias$diasDuplicar, countriesAndTerritories = rep('Argentina (proyección)', 30), continentExp = rep('America', 30));
df2 <- rbind(datoscovidok[,c('realDate', 'diasDuplicar', 'countriesAndTerritories', 'continentExp')], df);
#dias dup
graficoProyeccion <- ggplot(
data = df2[df2$countriesAndTerritories %in% paises2 | df2$countriesAndTerritories == 'Argentina (proyección)',],
mapping = aes(x=realDate, y=diasDuplicar, color = countriesAndTerritories)) +
geom_line(aes(linetype = continentExp)) +
#geom_smooth(aes(color=countriesAndTerritories, linetype = continentExp), se = FALSE) +
#geom_point() +
geom_hline(aes(yintercept = 25), color = 'red', linetype = 'dashed', show.legend = FALSE) +
geom_hline(aes(yintercept = 15), color = 'red', linetype = 'dashed', show.legend = FALSE) +
geom_hline(aes(yintercept = 5), color = 'red', linetype = 'dashed', show.legend = FALSE) +
geom_text(aes(as.Date('2020-03-15'), 25, label="Fase: Reapertura progresiva", vjust = -1, hjust = 0) , color = 'grey', size= 4) +
geom_text(aes(as.Date('2020-03-15'), 15, label="Fase: Segmentacion geografica", vjust = -1, hjust = 0) , color = 'grey', size= 4) +
geom_text(aes(as.Date('2020-03-15'), 5, label="Fase: Aislamiento administrado", vjust = -1, hjust = 0) , color = 'grey', size= 4) +
theme(legend.position="bottom") +
coord_cartesian(ylim = c(0,40), xlim = c(as.Date('2020-03-15'), max(df2$realDate)));
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
colores <- gg_color_hue(9);
colores[2] <- colores[1];
graficoProyeccion <- graficoProyeccion + scale_colour_manual(values = colores);
graficoProyeccion
