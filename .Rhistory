source('~/covid/publica/fasecero.github.io/scripts/grafico10.r')
source('~/covid/prediccion.r')
graficoProyeccion
#load libraries
library(readxl);
library(ggplot2);
library(patchwork);
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
#donwload file
url <- "https://www.ecdc.europa.eu/sites/default/files/documents/COVID-19-geographic-disbtribution-worldwide.xlsx";
destfile <- "COVID_19_geographic_disbtribution_worldwide.xlsx";
download.file(url, destfile);
datoscovidok <- read_excel(destfile);
#options
paises <- list('Argentina', 'Brazil', 'Chile', 'Colombia', 'Ecuador', 'United_States_of_America', 'Germany',  'Italy', 'South_Korea', 'China', 'Iran', 'Turkey');
paises2 <- list('Argentina', 'Brazil', 'Chile', 'Colombia', 'Germany', 'Italy', 'United_States_of_America', 'China');
theme_set(theme_bw());
caption = 'Elaboarción propia en base a datos del ECDC.';
grUnits <- "in";
grDevice <- 'png';
grDpi <- 120;
grPixelWidth <- 1600;
grPixelHeight <- 1200;
grHeight <- grPixelHeight / grDpi;
grWidth <- grPixelWidth / grDpi;
directorioInteractivo <- '~/covid/publica/fasecero.github.io';
archivoInteractivo <- 'index.html';
directorioGraficos <- 'graficos';
pathGraficos <- paste(directorioInteractivo, '/', directorioGraficos, sep ="");
#colores para los graficos de continentes: se mezclaban mucho el azul y el turquesa, el 4 es europa
coloresContinente <- gg_color_hue(7);
coloresContinente[4] <- 'red';
#pre-process file
#grafico10
datoscovidok$realDate <- as.Date(sprintf("%d/%2d/%d", datoscovidok$day,datoscovidok$month, datoscovidok$year), format = "%d/%m/%Y");
datoscovidok$casesAcum <- apply(datoscovidok, 1, function(x) sum(subset(datoscovidok, (geoId == x['geoId'] & realDate <= x['realDate']), select = 'cases')));
datoscovidok$casesAcumSemana <- apply(datoscovidok, 1, function(x) sum(subset(datoscovidok, (geoId == x['geoId'] & realDate <= x['realDate'] & realDate >= (as.Date(x['realDate'])-6) ), select = 'cases')));
datoscovidok$tasaDiaria <- ifelse(
datoscovidok$casesAcumSemana < 0,
NA,
ifelse(
datoscovidok$casesAcum - datoscovidok$casesAcumSemana == 0,
1,
with(datoscovidok, (casesAcum/(casesAcum - casesAcumSemana))^(1/7)-1)));
datoscovidok$diasDuplicar <- ifelse(datoscovidok$tasaDiaria == 0, NA, with(datoscovidok, log(2, tasaDiaria+1)));
#grafico mortalidad
datoscovidok$deathsAcum <- apply(datoscovidok, 1, function(x) sum(subset(datoscovidok, (geoId == x['geoId'] & realDate <= x['realDate']), select = 'deaths')));
datoscovidok$mortalidad <- datoscovidok$deathsAcum / datoscovidok$casesAcum;
#comparacion de tasa actuales
ultimaFecha <- max(datoscovidok$realDate);
caption <- paste(caption, ' Actualizado al ', ultimaFecha);
tasasActuales <- datoscovidok[datoscovidok$realDate == as.Date(ultimaFecha),];
#tasasActuales$tasaDiaria <- with(tasasActuales, (casesAcum/(casesAcum - casesAcumSemana))^(1/7)-1);
#comparacio de tasas anteriores
casosABuscar = max(datoscovidok[datoscovidok$countriesAndTerritories == 'Argentina', 'casesAcum']);
todosMayores = datoscovidok[datoscovidok$casesAcum >= casosABuscar,];
tasasAnteriores <- merge(aggregate(casesAcum ~ countriesAndTerritories, data = todosMayores, FUN = min), todosMayores);
#tasasAnteriores$tasaDiaria <- with(tasasAnteriores, (casesAcum/(casesAcum - casesAcumSemana))^(1/7)-1);
tasasAnteriores <- aggregate(tasasAnteriores, by = list(tasasAnteriores$countriesAndTerritories), FUN = min);
#continentes
norte <- list('United_States_of_America', 'Canada', 'Mexico');
datoscovidok$subContinente <- ifelse(datoscovidok$countriesAndTerritories %in% norte, 'North America (US, Canada, Mexico)', datoscovidok$continentExp);
datoscovidok$subContinente <- ifelse(datoscovidok$subContinente == 'America', 'America Latina y Caribe', datoscovidok$subContinente);
continente <- aggregate(datoscovidok[, c('cases', 'deaths', 'casesAcum', 'casesAcumSemana', 'deathsAcum')], by = list(datoscovidok$realDate, datoscovidok$subContinente), FUN = sum)
#aggregate(casesAcum ~ countriesAndTerritories, data = todosMayores, FUN = min)
poblacion <- aggregate(popData2018 ~ subContinente, data = datoscovidok[datoscovidok$realDate == as.Date('2020-04-27'),], FUN = sum);
continente <- merge(continente, poblacion, by.x = 'Group.2', by.y ="subContinente", all.x = TRUE);
continente$casosAcumCada100Mil <- continente$casesAcum / continente$popData2018 * 100000;
continente$casosAcumSemanaCada100Mil <- continente$casesAcumSemana / continente$popData2018 * 100000;
colores <- gg_color_hue(7);
#dias duplicacion y proyecccion argentina
datosargentina <- datoscovidok[datoscovidok$countriesAndTerritories == 'Argentina',];
datosargentina <- datosargentina[rev(order(datosargentina$realDate)), ];
ultimosDatos <- head(datosargentina, n= 15);
ultimoDato <- head(ultimosDatos, n= 1);
primerDato <- tail(ultimosDatos, n= 1);
model <- lm(diasDuplicar ~ realDate, data = ultimosDatos);
nuevosDias <- NULL;
nuevosDias$realDate <- seq(max(ultimosDatos$realDate)+1,by = 'day', length.out = 30);
nuevosDias$diasDuplicar <- predict(model, newdata = nuevosDias);
df <- data.frame(realDate = nuevosDias$realDate, diasDuplicar = nuevosDias$diasDuplicar, countriesAndTerritories = rep('Argentina (proyección)', 30), continentExp = rep('America', 30));
df2 <- rbind(datoscovidok[,c('realDate', 'diasDuplicar', 'countriesAndTerritories', 'continentExp')], df);
ggplot(
#data = continente[continente$Group.1 < (as.Date(max(continente$Group.1)) - 2),],
data = datoscovidok[datoscovidok$subContinente == 'America Latina y Caribe', ]
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)
#coord_cartesian(xlim = c(as.Date('2020-03-01'), as.Date(max(continente$Group.1))));
ggplot(
#data = continente[continente$Group.1 < (as.Date(max(continente$Group.1)) - 2),],
data = datoscovidok[datoscovidok$subContinente == 'America Latina y Caribe', ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)
#coord_cartesian(xlim = c(as.Date('2020-03-01'), as.Date(max(continente$Group.1))));
ggplot(
#data = continente[continente$Group.1 < (as.Date(max(continente$Group.1)) - 2),],
data = datoscovidok[datoscovidok$subContinente == 'America Latina y Caribe' & datoscovidok$popData2018 > 10000000, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)
#coord_cartesian(xlim = c(as.Date('2020-03-01'), as.Date(max(continente$Group.1))));
#graficos latam
paisesAmericaDelSur <- list('Argentina', 'Chile', 'Uruguay', 'Bolivia', 'Brasil', 'Paraguay', 'Ecuador', 'Colombia', 'Venezuela', 'Peru');
grLatam1 <- ggplot(
#data = continente[continente$Group.1 < (as.Date(max(continente$Group.1)) - 2),],
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-03-01'), as.Date(ultimaFecha)));
grLatam1
#graficos latam
paisesAmericaDelSur <- list('Argentina', 'Chile', 'Uruguay', 'Bolivia', 'Brazil', 'Paraguay', 'Ecuador', 'Colombia', 'Venezuela', 'Peru');
grLatam1 <- ggplot(
#data = continente[continente$Group.1 < (as.Date(max(continente$Group.1)) - 2),],
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-03-01'), as.Date(ultimaFecha)));
grLatam1
ggplot(
#data = continente[continente$Group.1 < (as.Date(max(continente$Group.1)) - 2),],
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
View(datoscovidok)
grLatam2 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum / popData2018 * 100000,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes cada 100.000 habitantes', caption = caption) +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam2
paisesAmericaDelSur <- list('Argentina', 'Chile', 'Brazil',  'Ecuador', 'Colombia', 'Peru');
grLatam1 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam2 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum / popData2018 * 100000,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes cada 100.000 habitantes', caption = caption) +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam1 <- grLatam1 + labs(caption = element_blank());
grMuertesLA <- grLatam1 + grLatam2;
grMuertesLA
grMuertesLA <- grMuertesLA + labs(title = 'Muertes en latinomérica');
grMuertesLA
#graficos latam
#paisesAmericaDelSur <- list('Argentina', 'Chile', 'Uruguay', 'Bolivia', 'Brazil', 'Paraguay', 'Ecuador', 'Colombia', 'Venezuela', 'Peru');
paisesAmericaDelSur <- list('Argentina', 'Chile', 'Brazil',  'Ecuador', 'Colombia', 'Peru');
grLatam1 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam2 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum / popData2018 * 100000,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes cada 100.000 habitantes', caption = caption) +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam1 <- grLatam1 + labs(caption = element_blank());
grMuertesLA <- grLatam1 + grLatam2 + plot_annotation(
title = 'Comparación cantidad de muertes por Covid-19 en países de latinoamérica'
#subtitle = 'These 3 plots will reveal yet-untold secrets about our beloved data-set',
#caption = 'Disclaimer: None of these plots are insightful'
);
grMuertesLA
ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
scale_x_date(breaks = breaks_pretty(10)) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
scale_x_date(breaks = pretty_breaks(10)) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
library(scales);
ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
scale_x_date(breaks = pretty_breaks(10)) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
#graficos latam
#paisesAmericaDelSur <- list('Argentina', 'Chile', 'Uruguay', 'Bolivia', 'Brazil', 'Paraguay', 'Ecuador', 'Colombia', 'Venezuela', 'Peru');
paisesAmericaDelSur <- list('Argentina', 'Chile', 'Brazil',  'Ecuador', 'Colombia', 'Peru');
grLatam1 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
scale_x_date(breaks = pretty_breaks(10)) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes', caption = caption)  +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam2 <- ggplot(
data = datoscovidok[datoscovidok$countriesAndTerritories %in% paisesAmericaDelSur, ],
mapping = aes(
x = realDate,
y = deathsAcum / popData2018 * 100000,
color = countriesAndTerritories)) +
geom_line() +
#geom_point() +
#scale_x_log10(labels =   scales::comma_format()) +
scale_y_continuous(labels = scales::comma_format()) +
scale_x_date(breaks = pretty_breaks(10)) +
theme(legend.position="bottom", legend.title  = element_blank()) +
labs(x = element_blank(), y = 'Muertes cada 100.000 habitantes', caption = caption) +
coord_cartesian(xlim = c(as.Date('2020-04-01'), as.Date(ultimaFecha)));
grLatam1 <- grLatam1 + labs(caption = element_blank());
grMuertesLA <- grLatam1 + grLatam2 + plot_annotation(
title = 'Comparación cantidad de muertes por Covid-19 en países de latinoamérica'
#subtitle = 'These 3 plots will reveal yet-untold secrets about our beloved data-set',
#caption = 'Disclaimer: None of these plots are insightful'
);
grMuertesLA
#paisesAmericaDelSur <- list('Argentina', 'Chile', 'Uruguay', 'Bolivia', 'Brazil', 'Paraguay', 'Ecuador', 'Colombia', 'Venezuela', 'Peru');
paisesAmericaDelSur <- list('Argentina', 'Chile', 'Brazil',  'Ecuador', 'Colombia', 'Peru');
source('~/covid/publica/fasecero.github.io/scripts/grafico10.r')
